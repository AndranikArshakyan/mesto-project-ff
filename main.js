(()=>{"use strict";var t,e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"ffb13434-2cfb-4f03-8a95-0559a6450320","Content-Type":"application/json"}},n=document.querySelector("#card-template").content,o=function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(t){return t.ok?t:Promise.reject("Ошибка: ".concat(t.status))}))})(n).then((function(){t.target.closest(".card").remove()})).catch((function(t){console.log(t)}))},r=function(t,n){(function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(n).then((function(e){t.target.closest(".card").querySelector(".card__like-count").textContent=e.likes.length,t.target.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)}))},c=function(t,e,o,r){var c=n.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__image"),i=c.querySelector(".card__title"),a=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-count");return u.setAttribute("src",e.link),u.setAttribute("alt","".concat(e.name)),i.textContent=e.name,l.textContent=e.likes.length,a.addEventListener("click",(function(n){return t(n,e._id)})),s.addEventListener("click",(function(t){return o(t,e._id)})),u.addEventListener("click",(function(){return r(e)})),c},u=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keyup",a)},i=function(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keyup",a)},a=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");i(e)}},s=function(t){t.querySelector(".popup__close").addEventListener("click",(function(){i(t)})),t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&i(t)}))},l=function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove("".concat(n)),r.classList.remove("".concat(o)),r.textContent=""},p=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove("".concat(n)),e.disabled=!1):(e.classList.add("".concat(n)),e.disabled=!0)},d=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){l(t,n,e.inputErrorClass,e.errorClass),n.setCustomValidity("")})),p(n,o,e.inactiveButtonClass)},_=document.querySelector(".popup_type_edit"),f=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_image"),y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),S=document.querySelector(".places__list"),h=_.querySelector(".popup__form"),b=h.querySelector(".popup__input_type_name"),q=h.querySelector(".popup__input_type_description"),C=_.querySelector(".popup__button"),E=f.querySelector(".popup__form"),k=E.querySelector(".popup__input_type_card-name"),L=E.querySelector(".popup__input_type_url"),g=f.querySelector(".popup__button"),x=m.querySelector(".popup__image"),A=m.querySelector(".popup__caption"),j=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),P=document.querySelector(".profile__image"),U=document.querySelectorAll(".spinner-content"),M=document.querySelectorAll(".spinner-content__error"),T=document.querySelectorAll(".spinner"),w=function(t){S.prepend(t)},D=function(t){x.src=t.link,x.alt=t.name,A.textContent=t.name,u(m)},V=function(t,e,n){var o=Array.from(e),r=Array.from(n);t?(o.forEach((function(t){t.classList.add("spinner_visible")})),r.forEach((function(t){t.classList.add("spinner-content_hidden")}))):(o.forEach((function(t){t.classList.remove("spinner_visible")})),r.forEach((function(t){t.classList.remove("spinner-content_hidden")})))};!function(){V(!0,T,U);var t=[fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))];Promise.all(t).then((function(t){var e;e=t[0],j.textContent=e.name,B.textContent=e.about,P.src=e.avatar,function(t,e){t.forEach((function(t){var n=c((function(e){return o(e,t._id)}),t,(function(e){return r(e,t._id)}),D);t.owner._id!==e._id&&n.querySelector(".card__delete-button").remove(),w(n)}))}(t[1],t[0])})).catch((function(t){!function(t,e,n){var o=Array.from(e),r=Array.from(n);o.forEach((function(e){e.textContent=t})),r.forEach((function(t){t.classList.add("spinner-content_visible")}))}("Ошибка: ".concat(t),M,U)})).finally((function(){V(!1,T,U)}))}(),y.addEventListener("click",(function(){u(_),d(h,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inactiveButtonClass:"popup__button_disabled"}),b.value=j.textContent,q.value=B.textContent})),v.addEventListener("click",(function(){u(f),d(E,{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inactiveButtonClass:"popup__button_disabled"})})),s(f),s(m),s(_),h.addEventListener("submit",(function(t){t.preventDefault(),C.textContent="Сохранение...",function(t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(b.value,q.value).then((function(t){j.textContent=t.name,B.textContent=t.about})).catch((function(t){C.textContent="".concat(t)})).finally((function(){C.textContent="Сохранить"})),i(_)})),E.addEventListener("submit",(function(t){var n,u;t.preventDefault(),g.textContent="Сохранение...",(n=k.value,u=L.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:u})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){w(c((function(e){return o(e,t._id)}),{name:t.name,link:t.link,likes:t.likes},(function(e){return r(e,t._id)}),D))})).catch((function(t){g.textContent="".concat(t)})).finally((function(){g.textContent="Сохранить"})),i(f),E.reset()})),t={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inactiveButtonClass:"popup__button_disabled"},Array.from(document.querySelectorAll("".concat(t.formSelector))).forEach((function(e){e.querySelector("".concat(t.submitButtonSelector)),Array.from(e.querySelectorAll("".concat(t.inputSelector))),e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e,n,o,r,c){var u=Array.from(t.querySelectorAll("".concat(e))),i=t.querySelector("".concat(n));p(u,i,c),u.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,n,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.patternErrorMessage):e.validity.valueMissing?e.setCustomValidity(e.dataset.valueMissingErrorMessage):e.setCustomValidity(""),e.validity.valid?l(t,e,n,o):function(t,e,n,o,r){var c=t.querySelector(".".concat(e.id,"-error"));e.classList.add("".concat(o)),c.textContent=n,c.classList.add("".concat(r))}(t,e,e.validationMessage,n,o)}(t,e,o,r),p(u,i,c)}))}))}(e,t.inputSelector,t.submitButtonSelector,t.inputErrorClass,t.errorClass,t.inactiveButtonClass)}))})();