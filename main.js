(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"ffb13434-2cfb-4f03-8a95-0559a6450320","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},n=document.querySelector("#card-template").content,r=function(n,r){(function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))})(r).then((function(e){n.target.closest(".card").querySelector(".card__like-count").textContent=e.likes.length,n.target.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))},o=function(n,r){(function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))})(r).then((function(e){n.target.closest(".card").querySelector(".card__like-count").textContent=e.likes.length,n.target.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)}))},c=function(e,t,r,o,c,i){var u=n.querySelector(".card").cloneNode(!0),a=u.querySelector(".card__image"),s=u.querySelector(".card__title"),l=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-button"),p=u.querySelector(".card__like-count");return a.setAttribute("src",e.link),a.setAttribute("alt","".concat(e.name)),s.textContent=e.name,p.textContent=e.likes.length,l.addEventListener("click",(function(t,n){c(n),i(t,e._id)})),d.addEventListener("click",(function(n){d.classList.contains("card__like-button_is-active")?o(n,e._id):t(n,e._id)})),a.addEventListener("click",(function(){return r(e)})),u},i=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keyup",a)},u=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",a)},a=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");u(t)}},s=function(e){e.querySelector(".popup__close").addEventListener("click",(function(){u(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&u(e)}))},l=function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(n)),o.classList.remove("".concat(r)),o.textContent=""},d=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("".concat(n)),t.disabled=!1):(t.classList.add("".concat(n)),t.disabled=!0)},p=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){l(e,n,t.inputErrorClass,t.errorClass),n.setCustomValidity("")})),d(n,r,t.inactiveButtonClass)},_=document.querySelector(".popup_type_edit"),f=_.querySelector(".popup__form"),m=f.querySelector(".popup__input_type_name"),y=f.querySelector(".popup__input_type_description"),v=_.querySelector(".popup__button"),h=document.querySelector(".profile__edit-button"),S=document.querySelector(".popup_type_new-card"),b=S.querySelector(".popup__form"),q=b.querySelector(".popup__input_type_card-name"),C=b.querySelector(".popup__input_type_url"),L=S.querySelector(".popup__button"),k=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_image"),g=E.querySelector(".popup__image"),x=E.querySelector(".popup__caption"),A=document.querySelector(".popup_type_edit-profile-image"),U=A.querySelector(".popup__form"),T=U.querySelector(".popup__button"),B=U.querySelector(".popup__input_type_url"),D=document.querySelector(".popup_type_delete-card"),M=D.querySelector(".popup__form").querySelector(".popup__button"),P=document.querySelector(".places__list"),w=document.querySelector(".profile__title"),I=document.querySelector(".profile__description"),N=document.querySelector(".profile__image"),O=document.querySelector(".preloader"),V=document.querySelector(".spinner"),j=V.querySelector(".spinner-content"),J=V.querySelector(".spinner-content__error"),H=V.querySelector(".spinner-circle"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible",inactiveButtonClass:"popup__button_disabled"},F={},G=function(e){P.prepend(e)},K=function(e){g.src=e.link,g.alt=e.name,x.textContent=e.name,i(E)},Q=function(e,t,n,r,o){e?(t.classList.add("preloader_visible"),n.classList.add("preloader_visible"),r.classList.add("spinner_visible"),o.classList.add("spinner-content_hidden")):(t.classList.remove("preloader_visible"),n.classList.remove("preloader_visible"),r.classList.remove("spinner_visible"),o.classList.remove("spinner-content_hidden"))};!function(){Q(!0,O,H,V,j);var n=[fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return t(e)}))];Promise.all(n).then((function(e){var t;t=e[0],w.textContent=t.name,I.textContent=t.about,N.style.backgroundImage="url(".concat(t.avatar,")"),function(e,t){e.forEach((function(e){var n=c(e,(function(t){return r(t,e._id)}),K,(function(t){return o(t,e._id)}),(function(){return i(D)}),(function(t){return W(t,e._id)}));(function(e,t){return e.likes.some((function(e){return e._id===t._id}))})(e,t)&&n.querySelector(".card__like-button").classList.add("card__like-button_is-active"),e.owner._id!==t._id&&n.querySelector(".card__delete-button").remove(),G(n)}))}(e[1],e[0]),Q(!1,O,H,V,j)})).catch((function(e){!function(e,t,n,r,o){t.classList.add("preloader_visible"),n.classList.add("spinner-circle_hidden"),r.textContent=e,o.classList.add("spinner-content_visible")}("".concat(e),O,H,J,j)}))}(),h.addEventListener("click",(function(){i(_),p(f,z),v.textContent="Сохранить",m.value=w.textContent,y.value=I.textContent})),k.addEventListener("click",(function(){i(S),p(b,z),L.textContent="Сохранить"})),N.addEventListener("click",(function(){i(A),p(U,z),T.textContent="Сохранить"})),s(S),s(E),s(_),s(A),s(D),f.addEventListener("submit",(function(n){n.preventDefault(),v.textContent="Сохранение...",function(n,r){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return t(e)}))}(m.value,y.value).then((function(e){w.textContent=e.name,I.textContent=e.about,u(_)})).catch((function(e){v.textContent="".concat(e)}))})),b.addEventListener("submit",(function(n){var a,s;n.preventDefault(),L.textContent="Сохранение...",(a=q.value,s=C.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:s})}).then((function(e){return t(e)}))).then((function(e){G(c({name:e.name,link:e.link,likes:e.likes},(function(t){return r(t,e._id)}),K,(function(t){return o(t,e._id)}),(function(e){return i(D)}),(function(t){return W(t,e._id)}))),u(S),b.reset()})).catch((function(e){L.textContent="".concat(e)}))})),U.addEventListener("submit",(function(n){n.preventDefault(),T.textContent="Сохранение...",function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return t(e)}))}(B.value).then((function(e){N.style.backgroundImage="url(".concat(e.avatar,")"),u(A)})).catch((function(e){T.textContent="".concat(e)}))}));var R,W=function(e,t){F={evt:e,cardId:t}};M.addEventListener("click",(function(){var n;M.textContent="Удаление...",(n=F.cardId,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))).then((function(){F.evt.target.closest(".card").remove(),u(D),M.textContent="Да"})).catch((function(e){M.textContent="".concat(e)}))})),R=z,Array.from(document.querySelectorAll("".concat(R.formSelector))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c){var i=Array.from(e.querySelectorAll("".concat(t))),u=e.querySelector("".concat(n));d(i,u,c),i.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.patternErrorMessage):t.validity.valueMissing?t.setCustomValidity(t.dataset.valueMissingErrorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,n,r):function(e,t,n,r,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add("".concat(r)),c.textContent=n,c.classList.add("".concat(o))}(e,t,t.validationMessage,n,r)}(e,t,r,o),d(i,u,c)}))}))}(e,R.inputSelector,R.submitButtonSelector,R.inputErrorClass,R.errorClass,R.inactiveButtonClass)}))})();